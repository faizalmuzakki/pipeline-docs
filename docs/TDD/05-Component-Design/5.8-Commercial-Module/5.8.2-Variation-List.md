# 5.8.2 Variation List

The Variation List component manages variation order documents through a simple CRUD interface. Users can upload variation documents with metadata including variation number, description, date, document name, attachment, and status for tracking contract changes and modifications.

```mermaid
graph LR
    UI_LIST["&laquo;UI&raquo;<br/>Variation List"]
    UI_FORM["&laquo;UI&raquo;<br/>Variation Form"]
    UI_DETAIL["&laquo;UI&raquo;<br/>Variation Detail"]

    SEC1["&laquo;Security&raquo;<br/>Middleware"]
    SEC2["&laquo;Security&raquo;<br/>Middleware"]
    SEC3["&laquo;Security&raquo;<br/>Middleware"]

    VAR_SVC1["&laquo;Application Service&raquo;<br/>VariationService"]
    VAR_SVC2["&laquo;Application Service&raquo;<br/>VariationService"]
    VAR_SVC3["&laquo;Application Service&raquo;<br/>VariationService"]

    DB1[("&laquo;Database&raquo;<br/>MongoDB")]
    DB2[("&laquo;Database&raquo;<br/>MongoDB")]
    DB3[("&laquo;Database&raquo;<br/>MongoDB")]
    STORAGE1[("&laquo;File Storage&raquo;<br/>S3/Local")]

    %% Variation List Flow
    UI_LIST -->|Request variation list| SEC1
    SEC1 -.->|Get variation list| VAR_SVC1
    VAR_SVC1 -.->|Query variation collection| DB1

    %% Create/Edit Variation Flow
    UI_FORM -->|Create/Edit variation| SEC2
    SEC2 -.->|Save variation| VAR_SVC2
    VAR_SVC2 -.->|Create/Update variation record| DB2
    VAR_SVC2 -.->|Store file| STORAGE1

    %% Variation Detail Flow
    UI_DETAIL -->|Request variation detail| SEC3
    SEC3 -.->|Get variation detail| VAR_SVC3
    VAR_SVC3 -.->|Query variation| DB3

    style UI_LIST fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style UI_FORM fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style UI_DETAIL fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC1 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC2 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC3 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style VAR_SVC1 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style VAR_SVC2 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style VAR_SVC3 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB1 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB2 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB3 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style STORAGE1 fill:#4FB3BF,stroke:#2a6d76,color:#fff
```

## 5.8.2.1 User Interface

### 5.8.2.1.1 Variation List

This is the entry point for viewing all variation order documents. Users can view variation records with DataTables providing server-side processing for pagination, sorting, and filtering. Users can add new variations, download attachments, copy variations, delete variations, or edit existing ones. Upon page load, it sends authentication token and retrieves variation list data.

### 5.8.2.1.2 Variation Form (Create/Edit)

This UI allows users to create or edit variation records. Users enter variation metadata and upload document file attachment. Upon submission, it saves the variation record and uploads the file to storage.

### 5.8.2.1.3 Variation Detail

This is a read-only view displaying variation information. Users can view all variation details and download the attached document file.

## 5.8.2.2 Security

Middleware validates the authentication token sent from Variation UIs. Only authenticated and authorized users can proceed to create, view, or manage variations.

**Security Checks:**
- `auth:api` - Validates JWT token via Laravel Passport
- `project.session:api` - Validates user has access to the project database
- `commercial.variation:RW` - Required to create and manage variation records
- `commercial.variation:R` - Required to view variation records

## 5.8.2.3 Application Services

### 5.8.2.3.1 Initial Data Retrieval

- **Variation Service**: Retrieves variation list data from variation collection.
- **User Service**: Fetches user information for displaying user-related data.

### 5.8.2.3.2 Variation Operations

The Variation Service provides the following operations for managing variation records:

- **Index**: Retrieves all variation records for list display.
- **Create**: Creates new variation record with metadata and file upload.
- **Read**: Retrieves variation detail with all information.
- **Update**: Updates variation record and optionally replaces the attached file.
- **Delete**: Removes variation record and associated file.
- **DataTables**: Retrieves variation list with server-side pagination, sorting, and filtering.
- **Download File**: Downloads attached document file.
- **Direct Copy**: Duplicates variation record.
- **Check Duplicate Variation**: Validates if variation already exists.

## 5.8.2.4 Database

MongoDB serves as the central data store for Variation. The component interacts with the following collections:

**Project Database (`{mongodb_project}_{project_code}`):**

- **`variation`** - Variation records. Key fields: _id, attachment_name, attachment_path, created_at, created_by, updated_at, updated_by.

**Global Database (`mongodb_global`):**

- **`user`** - User data for displaying user-related information.

**File Storage (`S3 / Local`):**

- **Variation Documents**: Stored in path `variation/{id}/{filename}`.

All create, update, and fetch operations on variations are handled through the Variation Service, ensuring consistent data access patterns and proper multi-tenant database routing.
