# 5.10 Dashboard Module

The Dashboard Main page is the entry point for the project, providing an overview of project progress and key metrics through customizable widgets. Users can add, edit, delete, and rearrange widgets to create a personalized dashboard view.

```mermaid
graph LR
    UI_DASH["&lt;&lt;UI&gt;&gt;<br/>Dashboard Main"]
    SEC1["&lt;&lt;Security&gt;&gt;<br/>Middleware"]
    SEC2["&lt;&lt;Security&gt;&gt;<br/>Middleware"]
    SEC3["&lt;&lt;Security&gt;&gt;<br/>Middleware"]
    SEC4["&lt;&lt;Security&gt;&gt;<br/>Middleware"]

    DASH_SVC1["&lt;&lt;Application Service&gt;&gt;<br/>DashboardService"]
    DASH_SVC2["&lt;&lt;Application Service&gt;&gt;<br/>DashboardService"]
    DASH_SVC3["&lt;&lt;Application Service&gt;&gt;<br/>DashboardService"]
    DASH_SVC4["&lt;&lt;Application Service&gt;&gt;<br/>DashboardService"]
    OVERALL_SVC["&lt;&lt;Application Service&gt;&gt;<br/>OverallSOWService"]
    TRANSFER_SVC["&lt;&lt;Application Service&gt;&gt;<br/>TransferService"]

    DB1[("&lt;&lt;Database&gt;&gt;<br/>MongoDB")]
    DB2[("&lt;&lt;Database&gt;&gt;<br/>MongoDB")]
    DB3[("&lt;&lt;Database&gt;&gt;<br/>MongoDB")]
    DB4[("&lt;&lt;Database&gt;&gt;<br/>MongoDB")]
    DB5[("&lt;&lt;Database&gt;&gt;<br/>MongoDB")]

    %% Initial Data Load Flow
    UI_DASH -->|Send Token| SEC1
    SEC1 -.->|Get widgets| DASH_SVC1
    DASH_SVC1 -.->|Query widgets| DB1
    SEC1 -.->|Get progress stats| OVERALL_SVC
    OVERALL_SVC -.->|Query progress data| DB2
    SEC1 -.->|Get chart stats| OVERALL_SVC
    OVERALL_SVC -.->|Query chart data| DB2
    SEC1 -.->|Get transfer progress| TRANSFER_SVC
    TRANSFER_SVC -.->|Query transfer data| DB2

    %% Create Widget Flow
    UI_DASH -.->|Event create widget| SEC2
    SEC2 -.->|Validate & create| DASH_SVC2
    DASH_SVC2 -.->|Save widget| DB3

    %% Edit Widget Flow
    UI_DASH -.->|Event edit widget| SEC3
    SEC3 -.->|Validate & update| DASH_SVC3
    DASH_SVC3 -.->|Update widget| DB4

    %% Delete Widget Flow
    UI_DASH -.->|Event delete widget| SEC4
    SEC4 -.->|Validate & delete| DASH_SVC4
    DASH_SVC4 -.->|Delete widget| DB5

    style UI_DASH fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC1 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC2 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC3 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style SEC4 fill:#2C5F7C,stroke:#1a3a4a,color:#fff
    style DASH_SVC1 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DASH_SVC2 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DASH_SVC3 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DASH_SVC4 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style OVERALL_SVC fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style TRANSFER_SVC fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB1 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB2 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB3 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB4 fill:#4FB3BF,stroke:#2a6d76,color:#fff
    style DB5 fill:#4FB3BF,stroke:#2a6d76,color:#fff
```

## 5.10.1 User Interface

This is the main dashboard page displaying customizable widgets for project overview. The interface shows widgets in a draggable grid layout with various chart types including circle progress charts (showing schedule vs actual progress), S-curve charts (showing cumulative progress over time). Each widget displays a title, last updated timestamp, and interactive chart. Users can add new widgets by clicking "Add Widget" button, edit existing widgets via dropdown menu, delete widgets via dropdown menu, enlarge/shrink chart widgets for better visibility, and drag-and-drop widgets to rearrange layout. Empty state shows a prompt to add the first widget. Upon page load, it sends a token for authentication, retrieves saved widgets configuration, fetches overall progress statistics for circle charts, retrieves chart statistics for S-curve, and gets transfer progress percentage if applicable.

## 5.10.2 Security

Middleware validates the authentication token sent from the Dashboard Main UI. Only authenticated and authorized users can proceed to view and manage dashboard widgets.

**Security Checks:**
- `auth:api` - Validates JWT token via Laravel Passport
- `project.session:api` - Validates user has access to the project database
- `user.privileges` - Checks for `project.dashboard:R` privilege to view dashboard
- `user.privileges` - Checks for `project.dashboard:W` privilege to create/edit/delete widgets

## 5.10.3 Application Services

### 5.10.3.1 Initial Data Retrieval

**DashboardService**: Retrieves saved dashboard widgets configuration including widget ID, title, graph type (circle_progress, s_curve), graph data source (project, transfer), item type filter, widget size class, enlarged state, and display order. Returns empty array if no widgets configured.

**OverallSOWService**: Retrieves overall progress statistics for circle progress charts by querying progress data per item type including schedule percentage, actual percentage, and last updated timestamp while also calculates the progress.

**OverallSOWService**: Retrieves chart statistics for S-curve charts including cumulative progress data over time, progress distribution by date ranges, and progress breakdown by item type with dates and percentage values.

**TransferService**: Retrieves transfer progress percentage by calculating total transferred quantity vs total project quantity including percentage value, transfer completed count, transfer total count, last updated timestamp, and status color indicator (red if transfer_completed < transfer_total, teal otherwise).

### 5.10.3.2 Widget Created

Creates a new dashboard widget with user-defined configuration. Validates widget parameters including title, graph type, data source, and item type filter. Creates widget record in dashboard collection with unique ID, user-defined title, selected graph type and data source, item type filter (if applicable), default widget size, display order (last position), and creation timestamp. Returns success status and new widget data.

### 5.10.3.3 Widget Updated

Updates existing dashboard widget configuration. Validates widget exists and user has permission. Updates widget fields including title, graph type, data source, item type filter, widget size, and enlarged state. Maintains original display order unless explicitly changed. Returns success status and updated widget data.

### 5.10.3.4 Widget Deleted

Deletes a dashboard widget from configuration. Validates widget exists and user has permission. Removes widget record from dashboard collection and reorders remaining widgets to fill the gap. Returns success status.

### 5.10.3.5 Widget Rearranged

Updates display order of dashboard widgets after drag-and-drop. Validates all widget IDs exist and user has permission. Updates `seq` field for all affected widgets based on new positions. Returns success status.

## 5.10.4 Database

Dashboard data is retrieved and updated in MongoDB across several collections:

**Project Database:**
• **dashboard** - Widget configuration records with titles, types, and layout
• **progress_sow_chart** - S-curve and any chart statistics data
• **transfer** - Transfer records for calculating transfer progress
• **sow** - SOW records for calculating overall project quantities
